Object subclass: #GCGstPackageWriter	instanceVariableNames: 'packageName packageXmlStream newline repoDir'	classVariableNames: ''	poolDictionaries: ''	category: 'Gitocello-Core'!!GCGstPackageWriter commentStamp: 'tfel 9/8/2009 20:24' prior: 0!I am very specific to GNU Smalltalk integration, as I write the package.xml file required to create GNU Smalltalk *.star format package files.For now I honour dependencies as set in Monticello and simply file in all the classes in the package at once.I will at some stage be able to properly handle test cases, which will make porting so much easier.!!GCGstPackageWriter methodsFor: 'information-retrieval' stamp: 'tfel 9/7/2009 21:31'!classes	| system |	system := Smalltalk organization.	^ ((system categoriesMatching: self packageName) union:		(system categoriesMatching: self packageName, '-*'))			inject: OrderedCollection new			into: [:list :next | 				list addAll: (system superclassOrder: next)]! !!GCGstPackageWriter methodsFor: 'information-retrieval' stamp: 'tfel 9/7/2009 20:36'!requiredPackages	^ (MCPackage named: self packageName) workingCopy requiredPackages! !!GCGstPackageWriter methodsFor: 'stream-writing' stamp: 'tfel 9/7/2009 21:18'!createPackageXml	self packageXmlStream 		reset;		nextPutAll: self preamble.	self requiredPackages do: [:pkg | self require: pkg].	"self testing."	self classes do: [:class | self fileIn: class].	self packageXmlStream nextPutAll: self postfix! !!GCGstPackageWriter methodsFor: 'stream-writing' stamp: 'tfel 9/8/2009 18:20'!fileIn: aClass	"Create the filein for this particular class in the conventional subfolder"	| subfolder filepath |	subfolder := (aClass category asString findBetweenSubStrs: '-') last.	filepath := subfolder, FileDirectory pathNameDelimiter asString, aClass name asString, '.st'.	self 		putAttribute: 'filein' with: filepath;		putAttribute: 'file' with: filepath! !!GCGstPackageWriter methodsFor: 'stream-writing' stamp: 'tfel 9/8/2009 18:15'!putAttribute: anXmlAttribute with: someContent	self packageXmlStream		nextPut: $<;		nextPutAll: anXmlAttribute;		nextPut: $>;		nextPutAll: someContent;		nextPutAll: '</';		nextPutAll: anXmlAttribute;		nextPut: $>;		nextPut: newline		! !!GCGstPackageWriter methodsFor: 'stream-writing' stamp: 'tfel 9/7/2009 20:58'!require: aPackage	self packageXmlStream		nextPutAll: '<prereq>';		nextPutAll: aPackage;		nextPutAll: '</prereq>';		nextPut: newline! !!GCGstPackageWriter methodsFor: 'fileOut' stamp: 'tfel 9/7/2009 21:27'!fileOutPackageXml	| fileName converter file |	self createPackageXml.	self packageXmlStream contents isAsciiString 		ifTrue: [converter := MacRomanTextConverter new]		ifFalse: [converter := UTF8TextConverter new].	fileName := self repoDir, FileDirectory pathNameDelimiter asString, 'package.xml'.	file := MultiByteFileStream new open: fileName forWrite: true.	file 	ifNil: [self error: 'Cannot open file'].	file text;		converter: converter;		nextPutAll: packageXmlStream contents;		close! !!GCGstPackageWriter methodsFor: 'initialize-release' stamp: 'tfel 9/7/2009 21:32'!initialize	super initialize.	newline := Character lf. "This should be configurable"	self packageXmlStream: (WriteStream on: (String new: 100))! !!GCGstPackageWriter methodsFor: 'accessing' stamp: 'tfel 9/7/2009 21:25'!newline	"Answer the value of newline"	^ newline! !!GCGstPackageWriter methodsFor: 'accessing' stamp: 'tfel 9/7/2009 21:25'!newline: anObject	"Set the value of newline"	newline := anObject! !!GCGstPackageWriter methodsFor: 'accessing' stamp: 'tfel 9/7/2009 20:47'!packageName	"Answer the value of packageName"	^ packageName! !!GCGstPackageWriter methodsFor: 'accessing' stamp: 'tfel 9/7/2009 20:47'!packageName: anObject	"Set the value of packageName"	packageName := anObject! !!GCGstPackageWriter methodsFor: 'accessing' stamp: 'tfel 9/7/2009 20:47'!packageXmlStream	"Answer the value of packageXmlStream"	^ packageXmlStream! !!GCGstPackageWriter methodsFor: 'accessing' stamp: 'tfel 9/7/2009 20:47'!packageXmlStream: anObject	"Set the value of packageXmlStream"	packageXmlStream := anObject! !!GCGstPackageWriter methodsFor: 'accessing' stamp: 'tfel 9/7/2009 21:25'!repoDir	"Answer the value of repoDir"	^ repoDir! !!GCGstPackageWriter methodsFor: 'accessing' stamp: 'tfel 9/7/2009 21:28'!repoDir: aDirectory	"Set the value of repoDir"	aDirectory isString		ifTrue: [repoDir := aDirectory]		ifFalse: [repoDir := aDirectory pathName]! !!GCGstPackageWriter methodsFor: 'literals' stamp: 'tfel 9/7/2009 20:55'!postfix	^ '</package>'! !!GCGstPackageWriter methodsFor: 'literals' stamp: 'tfel 9/7/2009 21:39'!preamble	^ '<package>', 		newline asString, 		'<!!-- THIS FILE IS AUTO-GENERATED!! EDITS _WILL_ BE LOST ON UPDATE!!!! --!!>', 		newline asString,		'<name>', self packageName, '</name>',  		newline asString,		'<namespace>', self packageName, '</namespace>', 		newline asString! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!GCGstPackageWriter class	instanceVariableNames: ''!!GCGstPackageWriter class methodsFor: 'instance creation' stamp: 'tfel 9/7/2009 21:19'!newFor: aPackage	^ self new		packageName: aPackage;		yourself! !